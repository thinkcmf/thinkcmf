<include file="../public/header"/>
</head>
<body class="body_none">
<style>
/*设置tab*/
.pop_nav {
	padding:10px 15px 0;
	margin-bottom:10px;
}
.pop_nav ul{
	border-bottom:1px solid #e3e3e3;
	padding:0 5px;
	height:25px;
	clear:both;
}
.pop_nav ul li{
	float:left;
	margin-right:10px;
}
.pop_nav ul li a{
	float:left;
	display:block;
	padding:0 10px;
	height:25px;
	line-height:23px;
}
.pop_nav ul li.current a{
	border:1px solid #e3e3e3;
	border-bottom:0 none;
	color:#333;
	font-weight:700;
	background:#fff;
	position:relative;
	border-radius:2px;
	margin-bottom:-1px;
}
.pop_cont{
	padding:0 15px;
}
/*上传*/
.edit_menu_cont {
    padding: 10px 15px;
}
.edit_uping {
    height: 30px;
    margin: 10px 0px;
    position: relative;
}
.edit_uping .num {
    color: #999999;
    position: absolute;
  right: 1px;
  top:10px;
    margin-top: 5px;
}
.edit_uping .num em {
    color: #FF5500;
    font-style: normal;
}
.eidt_uphoto {
    border: 1px solid #CCCCCC;
}
.eidt_uphoto ul {
    width: 100%;
    height: 280px;
    overflow-y: scroll;
    padding-bottom: 10px;
    position: relative;
}
.eidt_uphoto li{
  list-style: none;
  width: 87px;
  margin-left: 10px;
  position: relative;
  display: inline-block;
}

.eidt_uphoto .invalid {
    background: none repeat scroll 0 0 #FBFBFB;
    border: 1px solid #CCCCCC;
    height: 98px;
    position: relative;
    width: 78px;
}
.eidt_uphoto .invalid .error {
    padding: 30px 1px;
    text-align: center;
}
.eidt_uphoto .no {
    background: url("__TMPL__/public/assets/images/upload_pic.jpg") no-repeat scroll center center #FBFBFB;
    border: 1px solid #CCCCCC;
    height: 98px;
    overflow: hidden;
    text-indent: -2000em;
}
.eidt_uphoto .nouplode {
    background: #FBFBFB;
    border: 1px solid #CCCCCC;
    height: 98px;
    overflow: hidden;
	text-align: center;
	padding: 0px 5px 0px 5px;
}
.eidt_uphoto .schedule {
    background: none repeat scroll 0 0 #FFFFFF;
    border: 1px solid #CCCCCC;
    height: 98px;
    line-height: 98px;
    position: relative;
    text-align: center;
}
.eidt_uphoto .schedule span {
    background: none repeat scroll 0 0 #F0F5F9;
    height: 98px;
    left: 0;
    position: absolute;
    top: 0;
}
.eidt_uphoto .schedule em {
    left: 0;
    position: absolute;
    text-align: center;
    top: 0;
    width: 78px;
    z-index: 1;
}
.eidt_uphoto .get{
	background:#ffffff;
	border:1px solid #cccccc;
	position:relative;
	overflow:hidden;
}
.eidt_uphoto .selected{
	border:2px solid #1D76B7;
}
.eidt_uphoto .get img{
	cursor:pointer;
}
.eidt_uphoto .del{
	position:absolute;
	width:15px;
	height:15px;
	background:url("__TMPL__/public/assets/images/upload_del.png") no-repeat;
	right:1px;
	top:1px;
	overflow:hidden;
	text-indent:-2000em;

}
.eidt_uphoto .del:hover{
	background-position:-20px 0;
}
.eidt_uphoto li img{
	vertical-align:top;
	height:75px;
    width: 87px;
	border-bottom:1px solid #ccc;
}
.eidt_uphoto .get input{
	border:0;
	outline:0 none;
	margin-left:3px;
}
.eidt_uphoto .get .edit{
	position:absolute;
	height:22px;
	line-height:22px;
	text-align:center;
	width:78px;
	bottom:0;
	left:0;
	background:#e5e5e5;
	color:#333;
	filter:alpha(opacity=70);
	-moz-opacity:0.7;
	opacity:0.7;
	display:none;
}
.eidt_uphoto li:hover .edit,
.eidt_uphoto li:hover .del{
	/*text-decoration:none;
	display:block;*/
}

.eidt_uphoto li.success span {
  background: rgba(0, 0, 0, 0) url("__STATIC__/js/ueditor/dialogs/image/images/success.png") no-repeat scroll right bottom;
  bottom: 0;
  display: block;
  height: 40px;
  left: 0;
  top: 40px;
  position: absolute;
  width: 100%;
  z-index: 200;
}
</style>

<div class="wrap " style="padding:5px;">
    <ul class="nav nav-tabs">
      <li  class="active" ><a  href="#A" data-toggle="tab" >上传附件</a></li>
      <li class=""><a href="#B" data-toggle="tab" >网络文件</a></li>
    </ul>
  <div class="tabbable">
    <div class="tab-content ">
      <div  class="tab-pane active" id="A">
        <div class="">
          <div class="edit_uping">
            <!--选择按钮-->
            <div id="container">
              <a id="pickfiles"  class="btn btn-default" href="javascript:;;">选择图片</a>
              <a id="uploadfiles" class="btn btn-primary" href="javascript:;">点击上传</a>
            </div>
            <span class="num">可以上传<em>{$file_upload_limit<=1 ?1:"多"}</em> 个附件,单文件最大 <em>2048 KB</em>，<em style="cursor: help;" title="可上传格式：jpg,jpeg,gif,png,bmp">支持格式？</em></span>
          </div>
          <div class="eidt_uphoto">
            <ul id="fsUploadProgress" class="container">
              <!--<li class="J_empty"><div class="no">暂无</div></li>-->
            </ul>
          </div>
        </div>
      </div>
      <div class="tab-pane" id="B"> 请输入网络地址
        <div class="bk3"></div>
        <input type="hidden" id="img_name" value="">
        <input type="text" id="info" name="info[filename]" class="input" value=""  style="width:600px;" placeholder="http://"  onblur="addonlinefile(this)">
      </div>

    </div>
  </div>

</div>

<script src="__ROOT__/static/js/admin.js"></script>
<script src="__STATIC__/js/plupload/plupload.full.min.js"></script>



<script type="text/javascript">
  var intMaxSize = 2*1024;


  function get_selected_files(){
    var files        =  [];


    var number  = jQuery("#fsUploadProgress li").size();
    for ( var i=0 ;i<number;i++)
    {

      var file         = new Object();
      file.filepath    = jQuery("#fsUploadProgress li").eq(i).attr("url");
      file.preview_url =  file.filepath;
      file.url         =  file.filepath;
      file.name        = jQuery("#fsUploadProgress li").eq(i).attr("img_name");
      if(file.url == "undefined")
      {
        alert("没有上传完成或者还没有点击开始上传！");
        return false;
      }
      files.push(file) ;
    }



    return files;
  }
  function get_selected_file(){
    var files        =  [];
    var file         = new Object();
    file.filepath    = jQuery("#info").val();
    file.preview_url =  file.filepath;
    file.url         =  file.filepath;
    file.name        = jQuery("#img_name").val();
    files[0]         = file;

    return files;
  }
  // Custom example logic

  //file为plupload事件监听函数参数中的file对象,callback为预览图片准备完成的回调函数
  function previewImage(file, callback)
  {
    if (!file || !/image\//.test(file.type)) return; //确保文件是图片
    //gif使用FileReader进行预览,因为mOxie.Image只支持jpg和png
    if (file.type == 'image/gif')
    {
      var fr = new mOxie.FileReader();
      fr.onload = function () {
        callback(fr.result);
        fr.destroy();
        fr = null;
      };
      fr.readAsDataURL( file.getSource() );
    } else {
      var preloader = new mOxie.Image();
      preloader.onload = function () {
        //preloader.downsize(550, 400);//先压缩一下要预览的图片,宽300，高300
        var imgsrc = preloader.type == 'image/jpeg' ? preloader.getAsDataURL('image/jpeg', 80) : preloader.getAsDataURL(); //得到图片src,实质为一个base64编码的数据
        callback && callback(imgsrc); //callback传入的参数为预览图片的url
        preloader.destroy();
        preloader = null;
      };
      preloader.load(file.getSource());
    }
  }




  var uploader = new plupload.Uploader({
    runtimes : 'html5,flash,silverlight,html4',
    browse_button : 'pickfiles', // you can pass an id...
    container: document.getElementById('container'), // ... or DOM Element itself
    url : "{:url('asset/Asset/plupload')}",
    flash_swf_url : '__STATIC__/js/plupload/Moxie.swf',
    silverlight_xap_url : '__STATIC__/js/plupload/Moxie.xap',
    multi_selection: {$file_upload_limit<=1 ? 0 : 1 },
    filters : {
      max_file_size : '2mb',
      mime_types: [
        {title : "Image files", extensions : "jpg,gif,png,jpeg,bmp"},
      ]
    },

    init: {
      PostInit: function() {
        document.getElementById('fsUploadProgress').innerHTML = '';

        document.getElementById('uploadfiles').onclick = function() {
          uploader.start();
          return false;
        };
      },

      FilesAdded: function(uploader, files) {
        var msgFlg = 0;
        for (var i = 0, len = files.length; i < len; i++) {
          if (files[i].size > intMaxSize *1024) {
            uploader.files.splice(i, 1);
            msgFlg = 1;
          }else {
            !function (i) {
              previewImage(files[i], function (imgsrc) {
                $('#fsUploadProgress').html($('#fsUploadProgress').html() +
                        '<li  class="pull-left" id="' + files[i].id + '">'
                        +'<img class="img-responsive"  src="' + imgsrc + '" name="' + files[i].name + '" />'
//                        +'<p>'+ files[i].name +'</p>'
                        +'<p class="size">('+plupload.formatSize(files[i].size) +')</p>'
                        +'<a href="###" class="del pic_delete" data-val=' + files[i].id
                        +'>删除</a><br/>'
                        +'<span ></span>'
                        +'</li>');
              })
            }(i);
          }
        }
        if (msgFlg == 1) {
          alert("上传图片小于"+intMaxSize+"K");
        }

      },

      UploadProgress: function(up, file) {

       // id="info"
        //jQuery("#"+file.id+" .size").html(jQuery("#"+file.id+" .size").html()+ '<span>' + file.percent + "%</span>")
        //document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
      },
      FileUploaded: function(up, file, info) {
        jQuery("#"+file.id).addClass("success");
        jQuery("#"+file.id+" a").remove();
        var obj = data = $.parseJSON(info.response);
        jQuery("#"+file.id ).attr("url",obj.result);
        jQuery("#"+file.id ).attr("img_name",obj.name);
        jQuery("#info").val(obj.result);
        jQuery("#img_name").val(obj.name);

      },

    Error: function(up, err) {
        document.getElementById('console').appendChild(document.createTextNode("\nError #" + err.code + ": " + err.message));
      }
    }
  });

  uploader.init();
  $(document).on('click', '#fsUploadProgress a.pic_delete', function () {
    $(this).parent().remove();
    var toremove = '';
    var id = $(this).attr("data-val");
    for (var i in uploader.files) {
      if (uploader.files[i].id === id) {
        toremove = i;
      }
    }
    uploader.files.splice(toremove, 1);
  });
</script>
</body>
</html>