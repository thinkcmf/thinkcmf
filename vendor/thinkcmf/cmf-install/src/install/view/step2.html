<!doctype html>
<html>
<head>
    <include file="public/head"/>
    <script src="__STATIC__/js/jquery.js"></script>
    <style>
        .rewrite-correct, .rewrite-error {
            display: none;
        }
    </style>
</head>
<body>
<div class="wrap">
    <include file="public/header"/>
    <section class="section">
        <div class="step">
            <ul class="unstyled">
                <li class="current"><em>1</em>{:lang('ENVIRONMENT_DETECT')}</li>
                <li><em>2</em>{:lang('CREATE_DATA')}</li>
                <li><em>3</em>{:lang('INSTALL_FINISH')}</li>
            </ul>
        </div>
        <div class="server">
            <table width="100%">
                <tr>
                    <td class="td1">{:lang('ENVIRONMENT_DETECT')}</td>
                    <td class="td1" width="25%">{:lang('RECOMMENDED_CONFIG')}</td>
                    <td class="td1" width="25%">{:lang('CURRENT_STATE')}</td>
                    <td class="td1" width="25%">{:lang('REQUIREMENTS')}</td>
                </tr>
                <tr>
                    <td>{:lang('OS')}</td>
                    <td>{:lang('UNIX_LIKE')}</td>
                    <td><i class="fa fa-check correct"></i> {$os}</td>
                    <td>{:lang('UNLIMITED')}</td>
                </tr>
                <tr>
                    <td>{:lang('PHP_VERSION')}</td>
                    <td>>7.1.x</td>
                    <td><i class="fa fa-check correct"></i> {$phpversion}</td>
                    <td>7.1.0</td>
                </tr>
                <!-- 模块检测 -->
                <tr>
                    <td class="td1" colspan="4">{:lang('MODULE_DETECT')}</td>
                </tr>
                <tr>
                    <td>Session</td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        {$session}
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <tr>
                    <td>
                        PDO
                        <a href="https://www.baidu.com/s?wd={:lang('OPEN_EXT', ['extension'=>'PDO,PDO_MYSQL'])}" target="_blank">
                            <i class="fa fa-question-circle question"></i>
                        </a>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        {$pdo}
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <tr>
                    <td>
                        PDO_MySQL
                        <a href="https://www.baidu.com/s?wd={:lang('OPEN_EXT', ['extension'=>'PDO,PDO_MYSQL'])}" target="_blank">
                            <i class="fa fa-question-circle question"></i>
                        </a>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        {$pdo_mysql}
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <tr>
                    <td>
                        CURL
                        <a href="https://www.baidu.com/s?wd={:lang('OPEN_EXT', ['extension'=>'PHP CURL'])}" target="_blank">
                            <i class="fa fa-question-circle question"></i>
                        </a>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        {$curl}
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <tr>
                    <td>
                        GD
                        <a href="https://www.baidu.com/s?wd={:lang('OPEN_EXT', ['extension'=>'PHP GD'])}" target="_blank">
                            <i class="fa fa-question-circle question"></i>
                        </a>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        {$gd}
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <tr>
                    <td>
                        MBstring
                        <a href="https://www.baidu.com/s?wd={:lang('OPEN_EXT', ['extension'=>'PHP MBstring'])}" target="_blank">
                            <i class="fa fa-question-circle question"></i>
                        </a>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        {$mbstring}
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <tr>
                    <td>
                        fileinfo
                        <a href="https://www.baidu.com/s?wd={:lang('OPEN_EXT', ['extension'=>'PHP fileinfo'])}" target="_blank">
                            <i class="fa fa-question-circle question"></i>
                        </a>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        {$fileinfo}
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <notempty name="show_always_populate_raw_post_data_tip">
                    <tr>
                        <td>
                            $HTTP_RAW_POST_DATA{:lang('RAW_POST_DATA')}
                            <a href="https://www.baidu.com/s?wd={:lang('OPEN_EXT', ['extension'=>'$HTTP_RAW_POST_DATA'])}" target="_blank">
                                <i class="fa fa-question-circle question"></i>
                            </a>
                        </td>
                        <td>{:lang('CLOSE')}</td>
                        <td>
                            {$always_populate_raw_post_data}
                        </td>
                        <td>{:lang('CLOSE')}</td>
                    </tr>
                    <tr>
                        <td>$HTTP_RAW_POST_DATA{:lang('RAW_POST_SOLUTION')}</td>
                        <td colspan="3">
							<pre>
								;php.ini {:lang('RAW_POST_SOLUTION', ['item'=>'always_populate_raw_post_data'])}
								always_populate_raw_post_data = -1
							</pre>
                        </td>
                    </tr>
                </notempty>
                <!-- rewrite检测 -->
                <tr>
                    <td class="td1" colspan="4">{:lang('REWRITE_DETECT')}</td>
                </tr>
                <tr>
                    <td>
                        {:lang('SERVER')} rewrite
                        <a href="https://www.kancloud.cn/thinkcmf/faq/493492" target="_blank">
                            <i class="fa fa-question-circle question"></i>
                        </a>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                    <td>
                        <span class="rewrite-checking">{:lang('DETECTING')}...</span>
                        <span class="rewrite-correct"><i class="fa fa-check correct"></i> {:lang('SUPPORT')}</span>
                        <span class="rewrite-error"><i class="fa fa-remove error"></i> {:lang('NOT_SUPPORT')}</span>
                    </td>
                    <td>{:lang('ENABLE')}</td>
                </tr>
                <!-- 大小限制检测 -->
                <tr>
                    <td class="td1" colspan="4">{:lang('SIZE_DETECT')}</td>
                </tr>
                <tr>
                    <td>{:lang('UPLOAD_FILES')}</td>
                    <td>&gt;2M</td>
                    <td>
                        {$upload_size}
                    </td>
                    <td>{:lang('UNLIMITED')}</td>
                </tr>
            </table>
            <table width="100%">
                <tr>
                    <td class="td1">{:lang('DIR_PERMISSION')}</td>
                    <td class="td1" width="25%">{:lang('WRITE')}</td>
                    <td class="td1" width="25%">{:lang('READ')}</td>
                </tr>
                <foreach name="folders" item="vo" key="dir">
                    <tr>
                        <td>
                            {$dir}
                        </td>
                        <td>
                            <if condition="$vo['w']">
                                <i class="fa fa-check correct"></i> {:lang('WRITABLE')}
                                <else/>
                                <i class="fa fa-remove error"></i> {:lang('NOT_WRITABLE')}
                            </if>
                        </td>
                        <td>
                            <if condition="$vo['r']">
                                <i class="fa fa-check correct"></i> {:lang('READABLE')}
                                <else/>
                                <i class="fa fa-remove error"></i> {:lang('NOT_READABLE')}
                            </if>
                        </td>
                    </tr>
                </foreach>
            </table>
        </div>
        <div class="bottom text-center">
            <a href="__ROOT__/?s=install/index/step2" class="btn btn-primary">{:lang('TEST_AGAIN')}</a>
            <a href="{:url('index/step3')}" class="btn btn-primary">{:lang('NEXT')}</a>
        </div>
    </section>
</div>
<include file="public/footer"/>
<script>
    $.ajax({
        url: "__ROOT__/install/index/testRewrite",
        type: 'POST',
        dataType: 'JSON',
        success: function (data) {
            if (data.code) {
                $('.rewrite-correct').show();
                $('.rewrite-checking').hide();
            }
        },
        error: function () {
            $('.rewrite-error').show();
            $('.rewrite-checking').hide();
        }
    })
</script>
</body>
</html>
